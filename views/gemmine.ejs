<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/gemmine.css" />
    <title>Document</title>
  </head>
  <body>
    <img src="img/gemcave.jpeg" />

    <div class="menu">
      <p class="rules">
        Rules: Once you start timer you can't stop! Work for 1 hour to earn a
        gem, no pausing. You got this!
      </p>
      <button id="start-timer">START MINING!</button>
      <div id="timer"></div>

      <% const numGems = gems + 1 %>
      <form action="/gemmine:num" method="POST">
        <input
          class="gemEarn"
          type="hidden"
          name="age"
          value="<%= numGems %>"
        />
      </form>
    </div>
  </body>

  <script>
    // I need to create a form element
    // when the timer ends
    // I need to pop up a "recieve button disguised as a form"
    // then when the user clicks the button, it will make a post request and
    // then i need a route handler for the gems and have an update function in that

    const gemEarn = document.querySelector(".gemEarn");

    const startTimerButton = document.getElementById("start-timer");
    const timerElement = document.getElementById("timer");
    const newGem = document.querySelector(".gemEarn");
    const startTimer = () => {
      let timer;
      timer = 60 * 1;
      const remainingTime = setInterval(() => {
        // Decrement the timer by 1 second
        timer--;

        // Update the timer element
        // minutes by rounding integer and dividing by 60, seconds is the remainder
        timerElement.innerHTML = `${Math.floor(timer / 60)}:${timer % 60}`;
        if (timer === 0) {
          clearInterval(remainingTime);
          gemEarn.insertAdjacentHTML(
            "afterend",
            `<button class = "collect" type="submit">Collect Your Gem</button>`
          );
          // append a form
        }
      }, 1000);
    };

    startTimerButton.addEventListener("click", () => {
      // Set the timer to 60 minutes
      // Start the timer
      startTimer();
    });

    // Start the countdown timer
    const start = document
      .querySelector(".button")
      .addEventListener("click", () => {
        console.log("clicked");
        setInterval(updateTimer, 1000);
      });

    finished = true;

    if (finished === true) {
      gems++;
    }
  </script>
</html>
